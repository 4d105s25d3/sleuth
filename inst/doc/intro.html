<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Introduction to sleuth</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>



<!-- MathJax scripts -->
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h1>Introduction to sleuth</h1>

<p>Harold Pimentel, Nicolas Bray, Pall Melsted and Lior Pachter</p>

<h2>Overview</h2>

<p><strong>sleuth</strong> is a tool for the analysis and comparison of multiple related RNA-Seq experiments. Key features include:</p>

<ol>
<li>The use of boostraps to ascertain and correct for technical variation in experiments.</li>
<li>Implemention of a response error measurement model for inference that allows for a multitude of experimental designs.</li>
<li>Interactive plots that enable real-time exploratory data analysis.</li>
</ol>

<p>To use <strong>sleuth</strong>, RNA-Seq data must first be quantified with <a href="http://pachterlab.github.io/kallisto/"><strong>kallisto</strong></a>, which is a program for <em>very</em> fast RNA-Seq quantification based on pseudo-alignment. An important feature of <strong>kallisto</strong> is that it outputs bootstrapped estimates of transcript abundances, which can serve as proxies for technical replicates, allowing for an ascertainment of the variability in estimates due to the random processes underlying RNA-Seq as well as the statistical procedure of read assignment. <strong>kallisto</strong> can quantify 30 million human reads in less than 3 minutes on a Mac desktop computer using only the read sequences and a transcriptome index that itself takes less than 10 minutes to build. <strong>sleuth</strong> has also been designed to be lightweight and fast, and therefore RNA-Seq analysis with <strong>kallisto</strong> and  <strong>sleuth</strong> is tractable on a laptop computer in a matter of minutes.  </p>

<p>The model <strong>sleuth</strong> uses for performing differential analysis is a general linear model where there is error in the response. Formally, for a single transcript \(i\), the (log) &ldquo;true&rdquo; abundance \(y_i\) measured in read counts is modeled by</p>

<p>\[ y_i = \beta_0 + \beta_1 x_i + \epsilon_i \]</p>

<p>where \(x_i\) is an indicator variable describing the condition, \(\beta_0\) and \(\beta_1\) are parameters of the model and \(\epsilon_i\) is biological &ldquo;noise&rdquo;. However, conditioned on \(x_i\) and \(y_i\) the estimated number of counts from the observations in the experiment is given by </p>

<p>\[ D_i = y_i + q_i \]</p>

<p>where \(q_i\) represents technical &ldquo;noise&rdquo;, i.e. uncertainty in the measurement due to effects other than biological variability. The <strong>sleuth</strong> model incorporates the assumptions that the expectation \(E(q_i|y_i) = 0\), that \(E(D_i) = \beta_0 + \beta_1 x_i\)  and that the response error is <em>additive</em>, i.e. the variance \(V(D_i) = \sigma_i^2 + \sigma_{qi}^2\) where \(\sigma_i^2 = V(\epsilon_i)\) and \(\sigma_{qi}^2 = V(q_i|y_i)\). <strong>sleuth</strong> makes use of the boostraps from <strong>kallisto</strong> to estimate the \(\sigma_{qi}^2\), and the \(\sigma_i^2\) are estimated via a shrinkage procedure similar to that used in <a href="http://www.genomebiology.com/2014/15/2/R29">Limma Voom</a>.</p>

<p><strong>sleuth</strong> has been designed to facilitate the exploration of RNA-Seq data by utilizing the <a href="http://shiny.rstudio.com">Shiny</a> web application framework by RStudio. The worked example below illustrates how to load data into <strong>sleuth</strong> and how to open Shiny plots for exploratory data analysis. The code underlying all plots is available via the Shiny interface so that analyses can be fully &ldquo;open source&rdquo;. </p>

<h2>Installation</h2>

<p>To install this package, start R and first install rhdf5 by typing: </p>

<pre><code>source(&quot;http://bioconductor.org/biocLite.R&quot;)
biocLite(&quot;rhdf5&quot;)
</code></pre>

<p>Then type </p>

<pre><code>install(&quot;~/path/to/sleuth&quot;)
</code></pre>

<p>to install <strong>sleuth</strong> from the directory it has been downlaoded to.</p>

<h2>Example</h2>

<p>To explain how to use <strong>sleuth</strong> we provide an example based on the data in the &ldquo;Cuffdiff2&rdquo; paper:</p>

<ul>
<li><a href="http://www.nature.com/nbt/journal/v31/n1/full/nbt.2450.html">Differential analysis of gene regulation at transcript resolution with RNA-seq</a> by Cole Trapnell, David G Henderickson, Martin Savageau, Loyal Goff, John L Rinn and L Pachter, Nature Biotechnology <strong>31</strong>, 46&ndash;53 (2013).</li>
</ul>

<p>The human fibroblast RNA-Seq data for the paper is available on GEO at accession <a href="http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE37704">GSE37704</a>. The samples to be analyzed are the six samples LFB<em>scramble_hiseq_repA,LFB_scramble_hiseq_repB,LFB_scramble_hiseq_repC,LFB_HOXA1KD_hiseq_repA,LFB_HOXA1KD_hiseq_repA, and LFB_HOXA1KD_hiseq_repC. These are three biological replicates in each of two conditions that will be compared with __sleuth</em>_.</p>

<p>To analyze the data, first download the raw reads, install <strong>kallisto</strong> and then quantify the data with boostraps as described here. This step can be skipped for the purposes of the vignette, by downloading the <strong>kallisto</strong> processsed data directly from <a href="http://bio.math.berkeley.edu/sleuth/cuffdiff2/">here</a>.</p>

<p>The first step in a <strong>sleuth</strong> analysis is to load the data into R. Begin by specifying the path to the <strong>kallisto</strong> runs of the samples:</p>

<pre><code>base_dir &lt;- &quot;../path_to_the_kallisto_runs&quot;
sample_id &lt;- dir(base_dir)
kal_dirs &lt;- sapply(sample_id, function(id) file.path(base_dir, id, &quot;kallisto&quot;))
kal_res &lt;- lapply(sample_fnames, read_kallisto_h5, TRUE)
</code></pre>

<p>The next step is to load an auxillary table that describes the experimental design and the relationship between the kallisto directories and the samples:</p>

<pre><code>s2c &lt;- read.table(&quot;../path_to_metadata/hiseq_info.txt&quot;, header = TRUE)
s2c &lt;- select(s2c, sample = run_accession,
  condition)
</code></pre>

<p>The next step is to build a &ldquo;sleuth object&rdquo;. This first step is to load the kallisto processed data (abundance estimates, boostraps, etc.) into the object:</p>

<pre><code>so &lt;- sleuth_prep(kal_dirs, names(kal_dirs), s2c, ~ condition)
</code></pre>

<p>Then the parameters for the <strong>sleuth</strong> response error measurement model are estimated from the data:</p>

<pre><code>so &lt;- sleuth_fit(so)
</code></pre>

<p>Next the differential analysis (testing) is performed with</p>

<pre><code>so &lt;- sleuth_test(so, which_beta = &#39;conditionscramble&#39;)
</code></pre>

<p>At this point the sleuth object constructed from the kallisto runs has information about the data, the experimental design, the <strong>kallisto</strong> estimates, the model fit, and the testing. In other words it contains the entire analysis of the data. </p>

<p>To view the analysis type</p>

<pre><code>sleuth_results(so, &#39;conditionscramble&#39;) %&gt;% head
sleuth_interact(so)
</code></pre>

</body>

</html>
